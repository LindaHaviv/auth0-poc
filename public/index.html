<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>Auth POC</title>
    <base href="/">
    <!--  If you are targeting mobile audiences, Auth0 recommends that you add the following meta tag -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
    <!--  <div id="loading">
    <img src="assets/loading.svg" alt="Loading spinner">
  </div -->>
    <div class="content">
        <nav class="navbar navbar-default">
            <div class="container-fluid">
                <div class="navbar-header">
                    <a class="navbar-brand" href="#">Auth0 - JavaScript</a>
                    <button id="btn-home-view" class="btn btn-primary btn-margin">
                        Home
                    </button>
                    <button id="btn-login" class="btn btn-primary btn-margin">
                        Log In
                    </button>
                    <button id="btn-logout" class="btn btn-primary btn-margin">
                        Log Out
                    </button>
                </div>
            </div>
        </nav>
        <main class="container">
            <!-- home view -->
            <div id="home-view">
                <h4></h4>
            </div>
        </main>
        <h2>Welcome <span id="nick" class="nickname"></span></h2>
    </div>
    <script src="https://cdn.auth0.com/js/auth0/8.8/auth0.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script>

    // Initiating our Auth0Lock

    var webAuth = new auth0.WebAuth({
        domain: 'lindahaviv.auth0.com',
        clientID: 'F6Fg1rAPo4r9pzG6jSfQ2mjlnFArvRi3',
        redirectUri: window.location.href,
        responseType: 'token id_token',
        scope: 'openid email nickname'
    });

    $('#btn-login').click(function(e) {
        e.preventDefault();
        webAuth.authorize();

    });

    //ask webAuth to pass hash
    webAuth.parseHash({ hash: window.location.hash }, function(err, authResult) {
        if (err) {
            return console.log(err);
        }

        if (authResult && authResult.accessToken) {
            webAuth.client.userInfo(authResult.accessToken, function(err, profile) {

                // Now you have the user's information
                if (err) {
                    // Handle error
                    console.log(err);
                    return;
                } else {
                    console.log(profile);
                }
                document.getElementById('nick').textContent = profile.nickname;

                localStorage.setItem('accessToken', authResult.accessToken);
                localStorage.setItem('profile', JSON.stringify(profile));
            });



        }
    });


    // // Listening for the authenticated event
    // lock.on("authenticated", function(authResult) {
    //     //hide module post auth
    //     lock.hide();

    //     // Use the token in authResult to getUserInfo() and save it to localStorage
    //     lock.getUserInfo(authResult.accessToken, function(error, profile) {
    //         if (error) {
    //             // Handle error
    //             console.log(error);
    //             return;
    //         } else {
    //             console.log(profile);
    //         }

    //         document.getElementById('nick').textContent = profile.nickname;


    //         // Save token and profile locally

    //         localStorage.setItem('accessToken', authResult.accessToken);
    //         localStorage.setItem('profile', JSON.stringify(profile));


    //         // Update DOM
    //     });
    // });

    // $('#btn-login').click(function(e) {
    //     e.preventDefault();
    //     lock.show(
    //         // {
    //         //     callbackURL: 'http://localhost:3000',
    //         //     responseType: 'token'
    //         // }
    //     );

    // });

    // $('#btn-logout').click(function(e) {
    //     e.preventDefault();
    //     lock.logout();

    // });
    </script>
</body>

</html>